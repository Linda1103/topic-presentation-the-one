---
title: "气象对传染病影响的<br/>研究方法讨论"
author: " The One: 张晓蕊 刘光子 曹雪娇 李雪丽 刘颖"
date: "2020/4/3"
output:
  ioslides_presentation:
    smaller: true
    widecreen: true
---
##
<br/>
</br>
<font size=6>
**研究背景:**
</font>

&emsp;&emsp;2020年第一季度，新型冠状病毒（COVID-19）已在世界范围内广泛传播，引起国际

社会高度关注。整个国际社会在高度重视和防范疫情扩散的同时，也有不少声音说，随

着天气逐渐变暖，新冠疫情会逐渐得到抑制。
<br/>
<br/>
</br>
<font size=6>
**研究主题:**
</font>

&emsp;&emsp;武汉地区气象因素对新冠疫情的影响分析
<br/>
<br/>
</br>
<font size=6>
**研究方法:**
</font>

&emsp;&emsp;研究某因素对传染病影响的文献所采用的方法多样，如人工神经网络，GAM模

型，贝叶斯时空模型，ARIMA模型等。


<br/>
<br/>
<br/>
<br/>

# 人工神经网络ANN


## 人工神经网络概述
### 定义:
</br>
</br>
&emsp;&emsp;人工神经网络（ANN）是由具有适应性的简单单元组成的广泛并行互联的网络，它

的组织能够模拟生物神经系统对真实世界物体所作出的反应。

 - 人工神经网络从外界环境中学习获取知识。

 - 互连神经元的连接强度，即突触值，用于储存获取的知识。

## 人工神经网络概述
### 原理:
</br>
</br>
<div align=center>
![**M-P神经元模型**](C:/Users/Administrator/Desktop/topic/M-P.png)
</div>

## 人工神经网络概述
### 结构:
<div align=center>
![](C:/Users/Administrator/Desktop/topic/jiegou.png)
</div>
</br>
&emsp;&emsp;神经网络就是将多个神经元连接起来，组成一个网络。


## 人工神经网络概述
 </br>
 </br>


 - **优点**：
   - 非线性映射能力
   
   - 自学习和自适应能力
   
   - 泛化能力
   
   - 容错能力
   
 - **缺点**：
   - “黑盒子”性质
   
   - 推理过程为数值计算过程，会丢失一定信息
   

## 人工神经网络在传染病研究中的应用
</br>
</br>

 - **相关因素的探索**：人工神经网络内部的物理机制是非线性的，可以不受限制地自动去
 
学习识别变量间的关系，该特性适合于相关因素的探索性研究。

 - **预测预报**：人工神经网络不需要分析相关因素的具体关系，通过一定样本的学习训练
 
就能够总结出复杂的内在规律，从而进行疾病预测。

 - **筛查和诊断**：人工神经网络因其分布式信息存储方式、并行式信息处理方式、自组
 
织、自学习、自适应能力、强大的容错性和非线性处理能力，能够有效地对疾病进行

筛查和诊断。

## 相关案例

<font size=6>
[北京地区肠道传染病与气象因素的关联性分析](https://kns.cnki.net/KCMS/detail/detail.aspx?dbcode=CJFQ&dbname=CJFDLAST2015&filename=CZXX201501037&uid=WEEvREcwSlJHSldRa1FhdXNzY2Z1UlZwSW4xSUJoT2FqbDVNWmhhdzdrND0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!&v=MDQyNjVyRzRIOVRNcm85R1k0UjhlWDFMdXhZUzdEaDFUM3FUcldNMUZyQ1VSN3FmWk9WdkZ5N25WYnpBSmpmVGQ=)
</font>

### 研究方法

BP人工神经网络

### 变量

输入变量：气温、风速、降水量、相对湿度、水汽压   

输出变量：肠道传染病发病数

## 相关案例
### 具体方法

根据北京地区1970-2003年34年的气象数据和肠道传染病发病数据，将数据按7:3的比例分为训练集和测试集，利用BP人工神经网络，建立5个预测模型。

 - 模型1：选择1973-2003年的气象数据和1973-2003年肠道传染病发病数进行统计；
 - 模型2：选择1972-2002年的气象数据和1973-2003年肠道传染病发病数进行统计；
 - 模型3：选择1971-2001年的气象数据和1973-2003年肠道传染病发病数进行统计；
 - 模型4：选择1970-2000年的气象数据和1973-2003年肠道传染病发病数进行统计；
 - 模型5：选择3年前至当年的重要气象数据和1973-2003年肠道传染病发病数进行统计。
 

### 结论

1. 北京地区1970-2003年肠道传染病的发病不仅与其当年的气象变化有关，而且与1～3年前的气象变化均有关联。

2. 模型5的预测效果最佳，说明采用当年～3 年前的气象因素建立预测模型，效果要优于单用某一年的气象因子所建的模型。

## 人工神经网络在R语言中的实现
### R语言相关的包:
<br/>

 - **nnet包**提供了最常见的前馈反向传播神经网络算法。
 
 - **AMORE包**提供了更为丰富的控制参数，并可以增加多个隐藏层。
 
 - **neuralnet包**提供了弹性反向传播算法和更多的激活函数形式。
 
 - **RSNNS包**提供了更多的神经网络模型。
 
---

### R代码演示

 - 将数据集按7:3划分为训练集和测试集。

```{r}
library(MASS)
data<-Boston
ind<-sample(2,nrow(data),replace = T,prob = c(0.7,0.3))
trainset<-data[ind == 1,]
testset<-data[ind == 2,]
```

 - 使用**neuralnet函数**训练神经网络模型，生成网络图。

```{r fig.height=6,fig.width=8} 

library(neuralnet)
set.seed(1000)
net<-neuralnet(medv~.,trainset,hidden=c(5,3),threshold=0.005,learningrate=0.1,
               algorithm="rprop+",err.fct="sse",act.fct="logistic")
plot(net)
```


<font size=3>
`hidden`：每个隐藏层的神经元个数。   
`threshold`：误差函数的停止阈值。    
`learningrate`：算法的学习速率，仅用于BP算法。    
`algorithm`：计算神经网络的算法，包括`backprop`，`rprop+`，`rprop-`，`sag`，`slr`。    
`err.fct`：计算误差，包括`sse`，`se` 。   
`act.fct`：激活函数，包括`logistic`，`tanh`。
</font>

---

<div align=center>
![**神经网络图**](C:/Users/Administrator/Desktop/topic/Rplot.png)
</div>

 - 计算预测值和均方误差。

```{r}
result_testset<-compute(net,testset[,1:13])
MSE<-sum((testset$medv-result_testset$net.result))^2/nrow(testset)
MSE
```


<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>

# 广义相加模型GAM

## GAM概述
### GAM提出的背景：
<br/>
&emsp;&emsp;研究线性模型时，一般假设自变量x和因变量y之间为线性关系。对于非线性关系，

若能清楚的知道x和y的非线性形式，可以通过引入多项式的方法拟合x和y之间的非线性

关系。然而，在实际建模中，我们通常对于的非线性关系的形式不是很了解。广义相加模

型(GAM：Generalized Additive Model)可以在预先不知晓因变量与自变量之间关系的情

况下，使用非线性平滑项来拟合模型。

## GAM概述 
### 一般函数表达式：
<br/>
&emsp;&emsp;设x<sub>1</sub>与y之间为线性关系，x<sub>2</sub>与y之间为非线性关系。拟合
广义相加模型为：
$$y=\beta_0+\beta_1x_1+s(x_2)$$


- 模型有两个部分：`参数项`（β<sub>0</sub>+β<sub>1</sub>x<sub>1</sub>）和`非参数平滑项`s(x<sub>2</sub>)。

- `参数项`等同于最小二乘回归模型以及广义线性模型中可以包含的所有参数项。

## GAM概述
### 非参数平滑项 
<br/>
<br/>
&emsp;&emsp;将自变量划分成多个连续的区间，每一个区间都用单独的线性函数或非线性的低阶

多项式函数来拟合，这个函数被称为`样条函数（Spline）`。由于样条函数生成的是平

稳、光滑的回归曲线，因此经样条函数变化后的自变量也被称作`非参数平滑项`。

## GAM概述
### 节点数的选择
<br/>
&emsp;&emsp;可以用`广义交叉验证（GCV：Generalized Cross Validation）`的方法选择节点

数。这种方法的基本思路是:<br/>&emsp;&emsp;
<br/>
&emsp;&emsp;a）取出一部分数据,用样条函数拟合取出的数据；<br/>

&emsp;&emsp;b）假定一个节点数使样条函数拟合剩下的这些数据；<br/> 

&emsp;&emsp;c）重复a)和b)，直到每个观察值都被取出过一次，计算整个交叉验证过程的均方

根误差（RMSE：Root Mean Square Error）；；<br/> 

&emsp;&emsp;d）针对不同数量的节点重复a)~c)，最后选择最小RMSE时的节点数量。 


## GAM概述 
### 节点的位置
<br/>
&emsp;&emsp;a) 可以放在数据中的剧烈变化区域，如大气污染情况突然转好（如2015年北京的阅

兵式）或突然加重（如伦敦烟雾事件）的时间点；<br/> 
<br/>
&emsp;&emsp;b) 可以在数据变化复杂的地方多设置节点，在看起来更稳定的地方少设置节点，比

如研究大气污染的健康效应时，在暴露反应关系可能存在拐点的地方设置节点。 <br/>
<br/>
<br/>
&emsp;&emsp;**实际上，为便于操作，一般会截取长度相同的区间设置节点。** 

## GAM概述 
### 拟合函数的限制条件
<br/>
&emsp;&emsp;一般来说，如果在整个自变量范围内设置了k个不同的节点，最终将拟合k+1个不同

的多项式，最终得到的模型就是分段多项式。能拟合目标区间数据的函数有很多，有两个

限制条件:
<br/>
<br/>&emsp;&emsp;a) 多项式在节点处是连续的。
<br/>
<br/>&emsp;&emsp;b) 相邻多项式的导数必须相同（如果拟合的是m阶多项式，则应保证相邻多项式的

一阶导数至m-1阶导数均相等）。


## GAM概述 
### 样条函数
<br/>
&emsp;&emsp;像这样具有m-1个连续导数的m阶分段多项式，我们称之为`样条函数（Spline）`。

在实际研究中，我们一般使用三次样条函数，三次样条函数指的就是具有连续性、且一阶

和二阶导连续的三阶分段多项式。除此之外，也可选择自然三次样条函数（增加了三次样

条函数在边界区域的平滑性）、薄板样条函数（可同时平滑多个变量，因此一般在研究多

个变量的交互作用时使用）等。 

## GAM概述 
### GAM模型的优点 
<br/>
&emsp;&emsp;a)尽可能多地捕捉回归模型中的非线性因素对因变量的影响。

&emsp;&emsp;b)有效防止过度拟合。

&emsp;&emsp;c)不仅适用于多种复杂的非线性关系的分析，还可对疾病结局的长期和季节趋势、

气象因素等多种混杂因素进行校正。

## GAM在大气污染流行病学研究中的应用


### 建立大气污染流行病学GAM基础函数：
$$g[E(Y_t)]=\beta_0+\beta_1\,X_{t-\tau}+s(时间，v）+s(温度，v)+s（湿度，v）+DOW+\epsilon$$


- 其中g[E(Y<sub>t</sub>)] 为连接函数
- E(Y<sub>t</sub>)是指观察日t健康结局的预期值；
- X<sub>t</sub>是指t日的污染物平均浓度；
- &tau;是指大气污染物暴露的滞后日；
- β<sub>1</sub>是通过模型估计的指示变量系数；
- s（时间、v）、s（温度、v）、s（湿度、v）为非参数平滑函数，用于控制长期趋势的影响；
- DOW为哑变量，用于控制短期波动的影响。

## GAM在大气污染流行病学研究中的应用
<br/>

### 平滑参数自由度的确定：

- 参考之前的研究直接给定自由度；
- 利用广义交叉验证（ Generalized cross validation，GCV）来估计，GCV值越小越好；
- 利用赤池信息准则（Akaike informationcriterion，AIC），依据AIC最小选择自由度；
- 根据模型的残差的偏自相关（PACF）绝对值之和最小选取自由度。

## GAM在大气污染流行病学研究中的应用

### 模型评估
<br/>
&emsp;**模型的评估一般运用诊断图的形式进行，包括：**

- 偏差残差与时间的散点图

&emsp;理想情况下，残差图显示均匀的点带分布，随着时间的推移没有特定的趋势。如果散点偏离严重，则可能表明模型中缺少重要变量，或者长期趋势未得到充分控制。

- 偏差残差的部分自相关函数图

&emsp;理想情况下，偏差残差中应该无剩余自相关，模型中的变量可以解释结果中大部分的自相关。然而，由于模型中变量可能存在短暂的滞后效应，则会存在一定的自相关。

## GAM在大气污染流行病学研究中的应

### 敏感性分析
<br/>
&emsp;**判断模型是否稳健，需要进行敏感性分析**


- 改变模型中季节性和长期趋势的控制量（例如平滑样条函数的节点数）
- 暴露和混杂变量的引入方式（线性还是非线性）
- 滞后效应

&emsp;在最后确定模型之前，需要对模型进行灵敏度分析并绘制偏差残差的诊断图来验证模型假设是否正确，数据是否存在异常值。

## GAM在大气污染流行病学研究中的应用
<br/>
<br/>
<br/>
<br/>

### GAM单独应用及实例：
<br/>

- 当结局变量为率时，一般服从泊松分布，连接函数为log；
<br/>


- 当结局变量为疾病负担指标时，连接函数采用Identity函数。

## GAM在大气污染流行病学研究中的应用
<div align=center>
![](C:/Users/Administrator/Desktop/topic/3.png)
</div>


## GAM在大气污染流行病学研究中的应用
<br/>
<br/>
<br/>

### GAM与其他方法联用及实例：
<br/>

- GAM 可以将对季节、年龄、性别进行分层的研究与其他方法联用，还可利用meta分析或贝叶斯阶段分层分析克服不同地区的差异性，提高研究结果的普适性；

- 将 GAM 与K均值聚类算法或主成分分析法联用解决各污染物之间的共线性。

## GAM在大气污染流行病学研究中的应用
<br/>
![](C:/Users/Administrator/Desktop/topic/4.png)


## GAM在大气污染流行病学研究中的应用

### 展望：
<br/>
<br/>
&emsp;&emsp;受大气污染危害的人群范围广大，探讨其与健康的关系具有重要的公共卫生意义。时间序列分析方法中的GAM，相较于其他传统方法（线性回归等），可分析非线性关联性，简便易行，具有良好的应用前景。

&emsp;&emsp;基于新冠肺炎的传播途径之一就是气溶胶，气溶胶是指飞沫混合到空气中形成的，吸入后导致感染。这与空中得温度，湿度等都有关联，故对于研究气象对新冠肺炎的影响，GAM是一个不错的方法。


## GAM在R语言中的实现

### 用于构建GAM模型的R包：
<br/>

- `mgcv`包：用于GAM模型及其扩展模型的软件包

- `gss`包：基于光滑样条的结构多元函数的估计软件包

- `Hmisc`包：将广义线性模型`glm()`函数与平滑参数` ns()`函数进行拟合


&emsp;这3种软件包虽然都可构建`GAM`，但在具体参数设置上略有不同。

&emsp;`mgcv`软件包中`gam`函数在平滑参数估计中可设置拟合标准，如可设置` GCV` 或无偏风险

估计等方法，该软件包对平滑函数的估计更为灵活，模型运算速度更快，因此在大气污染

流行病学研究中得到广泛应用。


## GAM在R语言中的实现
**推荐一本学习GAM模型的书:[Generalized Additive Models](https://github.com/data-science-in-action/topic-presentation-the-one.git)**(书中所用数据在`gamair`包)

<br/>
<div align=center>
![](C:/Users/Administrator/Desktop/topic/2.png)
</div>


## GAM在R语言中的实现
```r
>install.packages("mgcv")
>library(mgcv)
>model <- gam(death ~ PM2.5 + s(Temperature, bs='cr' ), family=poisson, data=mydata)
>plot(model)
```
- `death`为因变量，`PM2.5`和`Temperature`为自变量。

- `PM2.5`为参数部分，`s()`为非参数平滑项。

- `s()`中，`bs`代表样条函数类型，`cr`为三次样条函数。

- `family`为因变量的分布类型；`data`为建模所需数据。

- `plot(model)`为平滑项绘图

## GAM在R语言中的实现

<center>**样条函数类型**</center>
<br/>

|Term|Spline|样条|
|:---|:---|:---|
|tp|thin plate regression spline|薄板回归样条|
|cr|penalized cubic regression spline|三次回归样条|
|cs|shrinkage version of cr|收缩三次回归样条|
|cc|cyclic cubic regression spline|循环三次回归样条|
|ps|P-spline |P样条|
|cp|cyclic p-spline|循环P样条|



## GAM在R语言中的实现
```r
>summary(model)
>AIC(model1,model2)
>gam.check(model)
```
- `summary(model)`可查看自变量参数的估计值、参数项和非参数项是否为有意义的预

测因子、评价模型预测情况的`GCV`值,该值越小越好。

- 可通过`AIC`值来选取合适的模型，`AIC`值越小越好。

- `gam.check(model)`用于验证模型的拟合效果，绘制出四个图，包括：

&emsp;(a)残差QQ图

&emsp;(b)线性预测值与残差散点图

&emsp;(c)残差直方图

&emsp;(d)拟合值与响应值散点图。

## GAM在R语言中的实现
<div align=center>
![](C:/Users/Administrator/Desktop/topic/1.png)
</div>



- 观察图(a)和图(c)，可看出残差符合正态分布，且残差值在 0 附近出现的频率最高。
- 观察图(b)，显示残差呈随机分布状态， 没有明显的趋势。
- 观察图(d)，最优模型拟合后响应变量和拟合值的匹配程度较好，基本呈 y=x 分布。
- 以上四张图都说明模型整体拟合效果较好。


## 参考文献

- [1]张轩,贺娟. 北京地区肠道传染病与气象因素的关联性分析[J].长春中医药大学学报,2015,31(01):105-109.

- [2]刘天,姚梦雷,黄继贵,陈红缨,黄淑琼,杨雯雯,蔡晶,吴然.BP神经网络在传染病时间序列预测中的应用及其MATLAB实现[J]. 预防医学情报杂志,2019,35(08):812-821.

- [3]张轩,费占洋,郝宇,连易,王鸿,贺娟.基于运气理论研究北京地区流行性脑脊髓膜炎发病与气象因素的相关性[J]. 环球中医药,2015,08(03):332-336.

- [4]林在生,林少凯,王恺,卢翠英,詹小海.低浓度PM_(2.5)对老年人群死亡的影响：基于2015—2018年福州市数据的时间序列研究[J].环境与职业医学,2020,37(02):157-161.

- [5]田璐,金曼,佟俊旺.应用Meta分析研究我国PM_(2.5)污染与居民每日死亡的关系[J].环境与职业医学,2015,32(11):1013-1018.

- [6]黄小刚,邵天杰,赵景波,曹军骥,吕晓虎.基于GAM模型的西安市O_(3)浓度影响因素解析[J/OL].环境科学:1-12[2020-04-02].

- [7] 樊琳,顾清,曾强.广义相加模型在大气污染流行病学研究中的应用进展[J].环境与职业医学,2019,36(07):676-681.
